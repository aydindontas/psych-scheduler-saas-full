<!doctype html>
<html lang="tr">
<head>
  <meta charset="utf-8"/>
  <meta name="viewport" content="width=device-width,initial-scale=1"/>
  <title>Panel</title>
  <link rel="stylesheet" href="/static/style.css"/>
</head>
<body>
  <div class="container">
    <h1>Hoş geldin</h1>

    <p><span class="badge">Tenant</span> <span id="tenantKey">-</span></p>
    <p><span class="badge">E-posta</span> <span id="meEmail">-</span></p>

    <div class="row" style="margin-top:16px">
      <button onclick="location.assign('/schedule')">Randevu Planla</button>
      <button style="background:#2a3652" onclick="logout()">Çıkış</button>
    </div>

    <p class="helper" style="margin-top:12px">API Base: <input id="apiBase" readonly></p>
    <div id="status" class="helper"></div>
  </div>

<script>
document.getElementById("loginForm").addEventListener("submit", async (e) => {
  e.preventDefault();
  const email = document.getElementById("email").value.trim().toLowerCase();
  const password = document.getElementById("password").value;

  try {
    const res = await fetch("/api/auth/login", {
      method: "POST",
      headers: {"Content-Type":"application/json"},
      body: JSON.stringify({ email, password })
    });

    if (!res.ok) {
      const err = await res.json().catch(()=>({detail:"Hata"}));
      alert("Giriş başarısız: " + (err.detail || res.status));
      return;
    }

    const data = await res.json();
    localStorage.setItem("token", data.access_token);
    localStorage.setItem("tenant_key", data.tenant_key);
    window.location.href = "/static/dashboard.html";
  } catch (e2) {
    alert("Ağ hatası: " + e2);
  }
});
</script>
</body>
</html>
